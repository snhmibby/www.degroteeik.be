<!-- bundle-gallery just dunks all the image page-resources -->

<!-- default arguments -->
{{ $height := or (.Get "height") 150 }}
{{ $thumbSizeHugo := printf "x%d" (mul 2 $height) }}
{{ $thumbSizeCSS := printf "%dpx" $height }}

<style>
	.gallery-thumb, .gallery-close {
		cursor: pointer;
	}
	ul.gallery {
		display: flex;
		flex-wrap: wrap;
		list-style:  none;
		padding-left: 0;
	}
	ul.gallery li {
		display: flex;
		flex-grow: 1;
		object-fit: fill;
		margin: 1px;
	}
	.gallery img {            
		height: {{ $thumbSizeCSS }};
		object-fit: cover;
		flex-grow: 1;
	}
	.gallery .gallery-modal {
		display: none;
		position: fixed;
		z-index: 10;
		padding-top: 50px;
		left: 0;
		top: 0;
		width: 100vw;
		height: 100vh;
		overflow: auto;
		background-color: rgba(0, 0, 0, 0.95);
	}
	.gallery-modal img {
		margin: auto;
		display: block;
		width: 90%;
		height: auto;
	}
	.gallery-modal .gallery-close {
		position: absolute;
		top: 0px;
		right: 15px;
		font-size:40px;
	}
</style>

<ul class="gallery">
	{{ range .Page.Resources.ByType "image" }}            
		{{ $thumb := .Resize $thumbSizeHugo }}
		<li>
			<img class="gallery-thumb" src="{{ $thumb.RelPermalink }}">
			<div class="gallery-modal">
				<span class="gallery-close">&times;</span>
				<img class="full-image" src="{{.RelPermalink}}">
			</div>
		</li>
	{{ end }}
</ul>

<script>
	for (let g of document.querySelectorAll(".gallery")) {
		for (let thumb of g.querySelectorAll(".gallery-thumb")) {
			let modal = thumb.nextElementSibling;
			thumb.onclick = function() {
				modal.style.display="block";
			}
			let closeBtn = modal.querySelector(".gallery-close");
			closeBtn.onclick = function() {
				modal.style.display="none";
			}
		}
	}
</script>
