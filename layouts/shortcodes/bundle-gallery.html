<!-- bundle-gallery just dunks all the image page-resources -->

<!-- default arguments -->
{{ $height := or (.Get "height") 150 }}
{{ $thumbSizeHugo := printf "x%d" (mul 2 $height) }}
{{ $id := now.UnixNano }}

<!-- should be in header, same as javascript below, but not sure it's possible with this theme :X -->
{{ $options := (dict "targetPath" "css/gallery.css") }}
{{ $css := resources.Get "components/gallery/gallery.scss" | toCSS $options }}
<link rel="stylesheet" href="{{ $css.RelPermalink }}">

<ul id="{{ $id }}" class="gallery">
	{{ range .Page.Resources.ByType "image" }}            
		{{ $thumb := .Resize $thumbSizeHugo }}
		<li>
			<img class="gallery-thumb" src="{{ $thumb.RelPermalink }}">
			<div class="gallery-modal">
				<img class="gallery-full" src="{{ .RelPermalink }}">
			</div>
		</li>
	{{ end }}
</ul>

{{ $jsOpts := dict "format" "esm" }}
{{ $gallery := resources.Get "components/gallery/gallery.js" | js.Build }}
<script src="{{ $gallery.RelPermalink }}" type="module"></script>
<script type="module">
	import {Gallery} from './gallery.js'
	new Gallery(document.getElementById("{{ $id }}"));
</script>
